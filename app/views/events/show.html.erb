<% provide :title, @event.title %>

<h1><%= @event.title %></h1>
<div class="row">
  <div class="col-lg-12">
    <p><%= date_format(@event.start_at) %></p>
    <p>แหล่งข้อมูลอ้างอิง: <%= external_link_to truncate_url(@event.source_url), truncate_url(@event.source_url) %></p>
    <div id="event-map"></div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-9 warning-preparation">
      <h3><strong>เตรียมตัวรับมือภัยพิบัติเบื้องต้น</strong></h3>
      <% if @event.category == "flood" || @event.category == "rainfall" %>
        <%= render partial: "events/flood_preparation" %>
      <% elsif @event.category == "earthquake" %>
        <%= render partial: "events/earthquake_preparation" %>
      <% else %>
        <%= render partial: "events/default_preparation" %>
      <% end %>
    </div>
    <div class="col-md-3 warning-emergency-contact">
      <h3><strong>ขอความช่วยเหลือพื้นที่ใกล้เคียง</h3></strong>
      <div class="contact-card">
        <p>
          <%= icon('hospital-o') %>
          <%= external_link_to("ร.พ. กรุงเทพคริสเตียน", "http://www.google.com/search?q=ร.พ. กรุงเทพคริสเตียน") %>
        </p>
        <p>
          <%= icon('phone') %>
            <%= external_link_to("02-233-6981 ถึง 9", "tel:022336981") %>
         </p>
        <p>
          <%= icon('map-marker') %>
          <%= external_link_to("124 สีลม สุริยวงศ์ บางรัก กรุงเทพมหานคร 10500", "http://maps.google.com/?q=124 สีลม สุริยวงศ์ บางรัก กรุงเทพมหานคร 10500") %>
        </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: { maxZoom: 15 }, internal: {id: 'event-map'}}, function(){
  markers = handler.addMarkers([
    {
      "lat": "<%= @event.latitude %>",
      "lng": "<%= @event.longitude %>",
      "picture": {
        "url": "<%= image_path("#{@event.category}.png") %>",
        "width":  32,
        "height": 37
      },
      "infowindow": "<%= @event.title %>"
    }
  ]);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
  google.maps.event.trigger(markers[0].getServiceObject(), 'click');
  });
</script>
